$('.form-button.pre_code').on('click',function(){var comment_text=$(".comments form textarea").val();comment_text+='<code></code>';$(".comments form textarea").val(comment_text);});var sendingComment=false;$('#send_comment').on('click',function(){if(sendingComment)return false;if(!$(".comments form #rulles_get_pop_up").is(":checked")){$('#send_comment').html(lang_words[0]+" <div class='btn__blobs'><div></div><div></div><div></div></div>");return false;}$('#send_comment').html(lang_words[1]+" <div class='btn__blobs'><div></div><div></div><div></div></div>");var message=$('.comments form textarea').val();var username=$('.comments form input').val();var reply_to=$('#comment-form .reply-block').attr("id");if(message.includes("vk.com/moderw")){alert("Ты заблокирован из-за спама");return;}$.ajax({url:'/ajax/add_comment.php',type:'POST',cache:false,data:{'message':message,'username':username,'unique_url':unique_url,'reply_to':reply_to},dataType:'html',beforeSend:function(){sendingComment=true;},success:function(data){if(data==true){$('.comments form textarea').val("");$('.comments form input').val("");$("#comment-form .reply-block").hide();$('#send_comment').html(lang_words[2]+" <div class='btn__blobs'><div></div><div></div><div></div></div>");if($("#comment-form .reply-block").attr("id")==0){message=message.replaceAll('\n','<br>');if(commentCount==='0'){$('.comments .all-comments').html('<div class="comment"><p class="user-name"><b>'+username+'</b> сейчас</p><div class="main-block">'+message+'</div></div>');commentCount='1';}else
$('.comments .all-comments').prepend('<div class="comment"><p class="user-name"><b>'+username+'</b> сейчас</p><div class="main-block">'+message+'</div></div>');}else
$('#comment-reply-'+reply_to).after('<div class="comment inner"><p class="user-name"><b>'+username+'</b> сейчас</p><div class="main-block">'+message+'</div></div><div class="clear"></div>');}else{if(data==false)alert("Что-то пошло не так! Сообщение не отправлено");else{switch(data){case"Имя не указано":shakeEffect("username_comment");break;case"Сообщение не указано":shakeEffect("message_comment");break;default:if(data.includes('лимит отправок'))alert(data);}}}sendingComment=false;}});});function replyToMessage(id,username){if($("#comment-form .reply-block").attr("id")==id){$("#comment-form .reply-block").hide();$("#comment-form .reply-block").attr("id",0);}else{$("#comment-form .reply-block").show();$("#comment-form .reply-block").text(lang_words[3]+" «"+username+"»");$("#comment-form .reply-block").attr("id",id);window.location.hash="";window.location.hash="#comments-block";}}$('#open_all_comments').on('click',function(){$(".reply-to-message, .comment").show();$('#open_all_comments').hide();});